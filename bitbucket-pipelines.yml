image: python:2.7

pipelines:
  default:
    - step:
        script:
          # Setting up the SSH key to interact with git
          - mkdir $HOME/.ssh
          - echo $GIT_CERT_KEY_BASE64 | base64 --decode > $HOME/.ssh/id_rsa
          - chmod 600 $HOME/.ssh/id_rsa
          - ssh-keyscan bitbucket.org >> $HOME/.ssh/known_hosts
          # Setting up CARINA Docker environment and variables
          - eval $(python deploy/carina_setup_env.py eve_cluster_test)
          # Launching tests
          - pip install tox
          - tox
  branches:
    development/*:
      - step:
          script:
            python deploy/deploy_eve_master.py scality wall-e
  branches:
    release/*:
      - step:
          script:
            python deploy/deploy_eve_master.py scality ring