branches:
  default:
    stage: "coverage_tests"

stages:
  coverage_tests:
    worker:
      type: "docker"
      path: "eve/coverage-reports"
    steps:
      - ShellCommand:
          name: "patch coverage report (timestamp)"
          command: >
            sed -ri "s/XXXXXXXXXXXXX/$(date +%s)000/" \
              /tmp/reports/coverage.xml
          haltOnFailure: True
          hideStepIf: True
      - SetProperty:
          name: "set property my_revision"
          property: "my_revision"
          value: "98f9379054719da6e7b5fd537b5a8e0ede096968"
      - PublishCoverageReport:
          repository: "scality/test_codecov_io"
          revision: "%(prop:my_revision)s"
          filepaths:
            - "/tmp/reports/coverage.xml"
          branch: "master"
          uploadName: "ucheck"
          configFile: ".codecov.yml"
