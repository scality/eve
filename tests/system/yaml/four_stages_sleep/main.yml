branches:
  default:
    stage: pre-merge
  development/*:
    stage: post-merge

stages:
  pre-merge:
    worker:
        type: docker
        path: eve/ubuntu-trusty-ctxt
    steps:
      - ShellCommand:
          name: echo revision and branch name
          command: echo REVISION=%(prop:got_revision)s BRANCH=%(prop:branch)s $DOCKER_HOST
      - TriggerStages:
          name: trigger compilation and test stages simultaneously
          stage_names:
            - compile
            - test
          waitForFinish: True
      - TriggerStages:
          name: trigger finalize stage
          stage_names:
            - finalize
          waitForFinish: True
  compile:
    worker:
        type: docker
        path: eve/ubuntu-trusty-ctxt
    steps:
      - ShellCommand:
          name: exit 0
          command: exit 0
  test:
    worker:
        type: docker
        path: eve/centos7-ctxt
    steps:
      - ShellCommand:
          name: exit 0
          command: exit 0
  finalize:
    worker:
      type: docker
      path: eve/ubuntu-trusty-ctxt
    steps:
      - ShellCommand:
          name: exit 0
          command: exit 0

  post-merge:
    worker:
        type: docker
        path: eve/ubuntu-trusty-ctxt
    steps:
      - ShellCommand:
          name: directory listing
          command: ls -l